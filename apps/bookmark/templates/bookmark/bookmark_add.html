{% extends 'core/base.html' %}

{% block content %}
<div class="container" id="add-bookmark">
    <h1 class="title">Add bookmark</h1>

    {% if canAdd|length == 0 %}
        <article class="message is-danger" v-if="errors.length">
            <div class="message-body">
                <p v-for="error in errors">
                    [[ error ]]
                </p>
            </div>
        </article>
        
        <form method="post" action="." v-on:submit="submitForm" novalidate>
            {% csrf_token %}

            <div class="field">
                <label class="label">{{ form.title.label_tag }}</label>

                <div class="control">
                    {{ form.title }}
                </div>
            </div>

            <div class="field">
                <label class="label">{{ form.url.label_tag }}</label>

                <div class="control">
                    {{ form.url }}
                </div>
            </div>

            <div class="field">
                <label class="label">{{ form.description.label_tag }}</label>

                <div class="control">
                    {{ form.description }}
                </div>
            </div>

            <div class="field">
                <div class="control">
                    <button type="submit" class="button is-primary">Submit</button>
                </div>
            </div>
        </form>
    {% else %}
        <article class="message is-danger">
            <div class="message-body">
                {{ canAdd }}
            </div>
        </article>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        new Vue({
            el: '#add-bookmark',
            delimiters: ['[[', ']]'],
            data () {
                return {
                    title: '',
                    url: '',
                    errors: []
                }
            },
            methods: {
                submitForm: function(e) {
                    this.errors = []

                    if (!this.title.length) {
                        this.errors.push('The title is missing')
                    }

                    if (!this.url.length) {
                        this.errors.push('The url is missing')
                    }

                    if (this.errors.length) {
                        e.preventDefault()

                        return false
                    }
                }
            }
        })
    </script>
{% endblock %}